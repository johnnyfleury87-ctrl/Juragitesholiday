(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[779],{6554:function(e,t,r){Promise.resolve().then(r.bind(r,5217))},5217:function(e,t,r){"use strict";r.r(t);var n=r(7437),s=r(2265),i=r(7648),a=r(9120),o=r(2563),l=r(8675);t.default=(0,o.c)(function(e){let{params:t}=e,{id:r}=t,[o,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(!0),[m,h]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{let e=(0,l.e)();try{let{data:t,error:n}=await e.from("bookings").select("*").eq("id",r).single();if(n)throw n;if(c(t),t){let{data:r}=await e.from("payments").select("*").eq("booking_id",t.id).single();r&&h(r)}}catch(e){console.error("Erreur:",e)}finally{u(!1)}})()},[r]);let g=async()=>{try{let e=(0,l.e)(),{error:t}=await e.from("payments").update({status:"paid"}).eq("id",m.id);if(t)throw t;let r=Math.ceil((new Date(o.check_out)-new Date(o.check_in))/864e5),n=10*r,{data:s}=await e.from("loyalty_accounts").select("id").eq("client_id",o.client_id).single();if(s){let{error:t}=await e.from("loyalty_ledger").insert([{loyalty_account_id:s.id,booking_id:o.id,points_delta:n,reason:"Booking completed"}]);t&&console.error("Error creating ledger:",t),await e.from("loyalty_accounts").update({points_balance:n}).eq("id",s.id)}h({...m,status:"paid"}),alert("Paiement marqu\xe9 comme pay\xe9")}catch(e){console.error("Erreur:",e),alert("Erreur lors de la mise \xe0 jour")}};return d?(0,n.jsxs)("div",{children:[(0,n.jsx)(a.Pm,{}),(0,n.jsx)("div",{className:"page-container container",children:"Chargement..."})]}):o?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.Pm,{}),(0,n.jsx)("div",{className:"page-container",children:(0,n.jsxs)("div",{className:"container",style:{maxWidth:"600px"},children:[(0,n.jsx)(i.default,{href:"/admin/reservations",style:{color:"#4F46E5"},children:"← Retour"}),(0,n.jsx)("h1",{style:{marginTop:"1rem"},children:"D\xe9tail de la r\xe9servation"}),(0,n.jsxs)("div",{style:{marginTop:"2rem",padding:"2rem",background:"#F9FAFB",borderRadius:"0.75rem"},children:[(0,n.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,n.jsx)("strong",{children:"Arriv\xe9e:"}),(0,n.jsx)("p",{children:new Date(o.check_in).toLocaleDateString("fr-FR")})]}),(0,n.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,n.jsx)("strong",{children:"D\xe9part:"}),(0,n.jsx)("p",{children:new Date(o.check_out).toLocaleDateString("fr-FR")})]}),(0,n.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,n.jsx)("strong",{children:"Personnes:"}),(0,n.jsx)("p",{children:o.num_guests})]}),(0,n.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,n.jsx)("strong",{children:"Total:"}),(0,n.jsxs)("p",{children:[o.total_price,"€"]})]}),(0,n.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,n.jsx)("strong",{children:"Statut:"}),(0,n.jsx)("p",{children:(0,n.jsx)("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"0.25rem",background:"#DCFCE7",color:"#15803D"},children:"Confirm\xe9e"})})]}),m&&(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{style:{marginTop:"2rem",borderTop:"1px solid #E5E7EB",paddingTop:"2rem"},children:[(0,n.jsx)("h3",{children:"Paiement"}),(0,n.jsxs)("div",{style:{marginTop:"1rem",marginBottom:"1rem"},children:[(0,n.jsx)("strong",{children:"Montant:"}),(0,n.jsxs)("p",{children:[m.amount,"€"]})]}),(0,n.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,n.jsx)("strong",{children:"Statut:"}),(0,n.jsx)("p",{children:(0,n.jsxs)("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"0.25rem",background:"paid"===m.status?"#DCFCE7":"#FEF3C7",color:"paid"===m.status?"#15803D":"#B45309"},children:["pending"===m.status&&"En attente","paid"===m.status&&"Pay\xe9"]})})]}),"pending"===m.status&&(0,n.jsx)("button",{onClick:g,className:"btn-primary",children:"Marquer comme pay\xe9"})]})})]})]})})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)(a.Pm,{}),(0,n.jsx)("div",{className:"page-container container",children:"R\xe9servation non trouv\xe9e"})]})})},2563:function(e,t,r){"use strict";r.d(t,{Q:function(){return o},c:function(){return l}});var n=r(7437),s=r(2265),i=r(9376),a=r(8675);function o(e){return function(t){let r=(0,i.useRouter)(),[o,l]=(0,s.useState)(!0),[c,d]=(0,s.useState)(null);return((0,s.useEffect)(()=>{(async()=>{let e=(0,a.e)(),{data:{user:t}}=await e.auth.getUser();if(!t){r.push("/login");return}d(t),l(!1)})()},[r]),o)?(0,n.jsx)("div",{children:"Chargement..."}):(0,n.jsx)(e,{...t,user:c})}}function l(e){return function(t){let r=(0,i.useRouter)(),[o,l]=(0,s.useState)(!0),[c,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(null);return((0,s.useEffect)(()=>{(async()=>{let e=(0,a.e)(),{data:{user:t}}=await e.auth.getUser();if(!t){r.push("/admin/login");return}let{data:n}=await e.from("org_members").select("role").eq("user_id",t.id).single();if(!n||"admin"!==n.role){r.push("/");return}d(t),m(n.role),l(!1)})()},[r]),o)?(0,n.jsx)("div",{children:"Chargement..."}):(0,n.jsx)(e,{...t,user:c,role:u})}}},9376:function(e,t,r){"use strict";var n=r(5475);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}})}},function(e){e.O(0,[16,120,971,117,744],function(){return e(e.s=6554)}),_N_E=e.O()}]);