(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[729],{9806:function(e,r,t){Promise.resolve().then(t.bind(t,1790))},1790:function(e,r,t){"use strict";t.r(r);var n=t(7437),s=t(2265),i=t(7648),a=t(9120),u=t(2563),o=t(8675);r.default=(0,u.c)(function(){let[e,r]=(0,s.useState)([]),[t,u]=(0,s.useState)(!0),[d,c]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{let e=(0,o.e)();try{let{data:{user:t}}=await e.auth.getUser();if(!t)return;let{data:n}=await e.from("org_members").select("org_id").eq("user_id",t.id).single();if(!n)return;c(n.org_id);let{data:s,error:i}=await e.from("booking_requests").select("id, property_id, check_in, check_out, status, num_guests").eq("status","pending").order("created_at",{ascending:!1});if(i)throw i;r(s||[])}catch(e){console.error("Erreur:",e)}finally{u(!1)}})()},[]);let l=async(e,t,n,s,i)=>{try{let a=(0,o.e)(),{data:u,error:d}=await a.from("bookings").insert([{booking_request_id:e,property_id:t,check_in:n,check_out:s,num_guests:i,status:"active"}]).select().single();if(d)throw d;let c=Math.ceil((new Date(s)-new Date(n))/864e5),{error:l}=await a.from("payments").insert([{booking_id:u.id,amount:100*c,status:"pending"}]);if(l)throw l;let{error:h}=await a.from("booking_requests").update({status:"accepted"}).eq("id",e);if(h)throw h;r(r=>r.filter(r=>r.id!==e))}catch(e){console.error("Erreur:",e),alert("Erreur lors de l'acceptation")}},h=async e=>{try{let t=(0,o.e)(),{error:n}=await t.from("booking_requests").update({status:"rejected"}).eq("id",e);if(n)throw n;r(r=>r.filter(r=>r.id!==e))}catch(e){console.error("Erreur:",e),alert("Erreur lors du rejet")}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.Pm,{}),(0,n.jsx)("div",{className:"page-container",children:(0,n.jsxs)("div",{className:"container",children:[(0,n.jsx)(i.default,{href:"/admin",style:{color:"#4F46E5"},children:"â† Retour"}),(0,n.jsx)("h1",{style:{marginTop:"1rem"},children:"Gestion des r\xe9servations"}),t?(0,n.jsx)("div",{children:"Chargement..."}):0===e.length?(0,n.jsx)("div",{style:{marginTop:"2rem",padding:"2rem",background:"#F9FAFB",borderRadius:"0.5rem"},children:(0,n.jsx)("p",{children:"Aucune demande en attente"})}):(0,n.jsx)("div",{style:{marginTop:"2rem"},children:e.map(e=>(0,n.jsxs)("div",{style:{padding:"2rem",border:"1px solid #E5E7EB",borderRadius:"0.5rem",marginBottom:"1rem",background:"#F9FAFB"},children:[(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"1rem",marginBottom:"1rem"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Arriv\xe9e"}),(0,n.jsx)("p",{children:e.check_in})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"D\xe9part"}),(0,n.jsx)("p",{children:e.check_out})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Personnes"}),(0,n.jsx)("p",{children:e.num_guests})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Statut"}),(0,n.jsx)("p",{children:"En attente"})]})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:"1rem"},children:[(0,n.jsx)("button",{onClick:()=>l(e.id,e.property_id,e.check_in,e.check_out,e.num_guests),className:"btn-primary",children:"Accepter"}),(0,n.jsx)("button",{onClick:()=>h(e.id),className:"btn-secondary",children:"Rejeter"})]})]},e.id))})]})})]})})},2563:function(e,r,t){"use strict";t.d(r,{Q:function(){return o},c:function(){return d}});var n=t(7437),s=t(2265),i=t(9376),a=t(8675),u=t(2867);function o(e){return function(r){let t=(0,i.useRouter)(),[u,o]=(0,s.useState)(!0),[d,c]=(0,s.useState)(null);return((0,s.useEffect)(()=>{(async()=>{let e=(0,a.e)(),{data:{user:r}}=await e.auth.getUser();if(!r){t.push("/login");return}c(r),o(!1)})()},[t]),u)?(0,n.jsx)("div",{children:"Chargement..."}):(0,n.jsx)(e,{...r,user:d})}}function d(e){return function(r){let t=(0,i.useRouter)(),[o,d]=(0,s.useState)(!0),[c,l]=(0,s.useState)(null),[h,m]=(0,s.useState)(null),[f,g]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{(async()=>{if(u.D){g(!0),l({id:"dev-user",email:"dev@mode"}),m("admin"),d(!1);return}let e=(0,a.e)(),{data:{user:r}}=await e.auth.getUser();if(!r){t.push("/admin/login");return}let{data:n}=await e.from("org_members").select("role").eq("user_id",r.id).single();if(!n||"admin"!==n.role){t.push("/");return}l(r),m(n.role),d(!1)})()},[t]),o)?(0,n.jsx)("div",{children:"Chargement..."}):(0,n.jsx)(e,{...r,user:c,role:h,isDevMode:f})}}},9376:function(e,r,t){"use strict";var n=t(5475);t.o(n,"usePathname")&&t.d(r,{usePathname:function(){return n.usePathname}}),t.o(n,"useRouter")&&t.d(r,{useRouter:function(){return n.useRouter}})}},function(e){e.O(0,[53,648,120,971,117,744],function(){return e(e.s=9806)}),_N_E=e.O()}]);