(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[250],{9911:function(e,t,n){Promise.resolve().then(n.bind(n,3712))},3712:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var a=n(7437),s=n(2265),r=n(8675),i=n(9816),l=n.n(i);function o(){let e=(0,r.e)(),[t,n]=(0,s.useState)("arrivals"),[i,o]=(0,s.useState)([]),[h,m]=(0,s.useState)(null),[_,g]=(0,s.useState)(!0),[j,x]=(0,s.useState)(null),[v,y]=(0,s.useState)([]),[b,f]=(0,s.useState)([]),[D,N]=(0,s.useState)([]),[C,S]=(0,s.useState)([]);return((0,s.useEffect)(()=>{(async()=>{try{let{data:t,error:n}=await e.from("properties").select("id, title, slug").eq("is_published",!0).order("title");if(n)throw n;o(t||[]),(null==t?void 0:t.length)>0&&m(t[0].id)}catch(e){x(e.message)}})()},[e]),(0,s.useEffect)(()=>{h&&(async()=>{g(!0);try{let[t,n,a,s]=await Promise.all([e.from("inventory_items").select("*").eq("property_id",h).order("category"),e.from("cleaning_sessions").select("*").eq("property_id",h).order("scheduled_date",{ascending:!1}),e.from("linens").select("*").eq("property_id",h).order("linen_type"),e.from("bookings").select("*").eq("property_id",h).gte("check_out",new Date().toISOString().split("T")[0]).order("check_in")]);if(t.error)throw t.error;if(n.error)throw n.error;if(a.error)throw a.error;if(s.error)throw s.error;y(t.data||[]),f(n.data||[]),N(a.data||[]),S(s.data||[])}catch(e){x(e.message)}finally{g(!1)}})()},[h,e]),j)?(0,a.jsxs)("div",{className:l().error,children:["Erreur : ",j]}):(0,a.jsxs)("div",{className:l().container,children:[(0,a.jsx)("h1",{children:"\uD83C\uDFE2 Gestion Op\xe9rationnelle"}),(0,a.jsxs)("div",{className:l().propertySelector,children:[(0,a.jsx)("label",{htmlFor:"property-select",children:"S\xe9lectionner un logement :"}),(0,a.jsx)("select",{id:"property-select",value:h||"",onChange:e=>m(e.target.value),children:i.map(e=>(0,a.jsx)("option",{value:e.id,children:e.title},e.id))})]}),(0,a.jsxs)("nav",{className:l().tabNav,children:[(0,a.jsx)("button",{className:"".concat(l().tab," ").concat("arrivals"===t?l().active:""),onClick:()=>n("arrivals"),children:"\uD83D\uDCC5 Arriv\xe9es / D\xe9parts"}),(0,a.jsx)("button",{className:"".concat(l().tab," ").concat("inventory"===t?l().active:""),onClick:()=>n("inventory"),children:"\uD83D\uDCE6 Inventaire"}),(0,a.jsx)("button",{className:"".concat(l().tab," ").concat("cleaning"===t?l().active:""),onClick:()=>n("cleaning"),children:"\uD83E\uDDF9 M\xe9nage"}),(0,a.jsx)("button",{className:"".concat(l().tab," ").concat("linens"===t?l().active:""),onClick:()=>n("linens"),children:"\uD83D\uDC55 Linge"})]}),(0,a.jsx)("div",{className:l().tabContent,children:_?(0,a.jsx)("div",{className:l().loading,children:"Chargement..."}):(0,a.jsxs)(a.Fragment,{children:["arrivals"===t&&(0,a.jsx)(c,{bookings:C}),"inventory"===t&&(0,a.jsx)(d,{items:v,propertyId:h,supabase:e}),"cleaning"===t&&(0,a.jsx)(u,{sessions:b,propertyId:h,supabase:e}),"linens"===t&&(0,a.jsx)(p,{linensData:D,propertyId:h,supabase:e})]})})]})}function c(e){let{bookings:t}=e,n=new Date().toISOString().split("T")[0],s=t.filter(e=>e.check_in>=n),r=t.filter(e=>e.check_out>=n&&e.check_in<n);return(0,a.jsxs)("div",{className:l().tabPanel,children:[(0,a.jsx)("h2",{children:"\uD83D\uDCC5 Planification Arriv\xe9es / D\xe9parts"}),r.length>0&&(0,a.jsxs)("section",{className:l().section,children:[(0,a.jsx)("h3",{children:"\uD83D\uDEAA D\xe9parts Pr\xe9vus"}),(0,a.jsx)("div",{className:l().list,children:r.map(e=>(0,a.jsxs)("div",{className:l().listItem,children:[(0,a.jsxs)("div",{className:l().itemHeader,children:[(0,a.jsxs)("strong",{children:["D\xe9part le ",new Date(e.check_out).toLocaleDateString("fr-FR")]}),(0,a.jsx)("span",{className:l().badge,style:{backgroundColor:"orange"},children:"\xc0 nettoyer"})]}),(0,a.jsxs)("p",{children:["Clients : ",e.num_guests," personnes"]})]},e.id))})]}),s.length>0&&(0,a.jsxs)("section",{className:l().section,children:[(0,a.jsx)("h3",{children:"\uD83D\uDD14 Arriv\xe9es Pr\xe9vues"}),(0,a.jsx)("div",{className:l().list,children:s.map(e=>(0,a.jsxs)("div",{className:l().listItem,children:[(0,a.jsxs)("div",{className:l().itemHeader,children:[(0,a.jsxs)("strong",{children:["Arriv\xe9e le ",new Date(e.check_in).toLocaleDateString("fr-FR")]}),(0,a.jsx)("span",{className:l().badge,style:{backgroundColor:"green"},children:"Pr\xeat"})]}),(0,a.jsxs)("p",{children:["Clients : ",e.num_guests," personnes | Dur\xe9e : ",Math.ceil((new Date(e.check_out)-new Date(e.check_in))/864e5)," nuits"]})]},e.id))})]}),0===t.length&&(0,a.jsx)("p",{className:l().empty,children:"Aucune r\xe9servation pr\xe9vue pour cette p\xe9riode."})]})}function d(e){let{items:t,propertyId:n,supabase:r}=e,[i,o]=(0,s.useState)(!1),[c,d]=(0,s.useState)({item_name:"",category:"Vaisselle",quantity:1,condition:"ok",notes:""}),u=t.reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{}),p=async e=>{e.preventDefault();try{let{error:e}=await r.from("inventory_items").insert([{property_id:n,...c}]);if(e)throw e;d({item_name:"",category:"Vaisselle",quantity:1,condition:"ok",notes:""}),o(!1),window.location.reload()}catch(e){alert("Erreur : "+e.message)}},h=e=>{switch(e){case"ok":return"#4CAF50";case"\xe0 remplacer":return"#FF9800";case"HS":return"#F44336";default:return"#757575"}};return(0,a.jsxs)("div",{className:l().tabPanel,children:[(0,a.jsxs)("div",{className:l().header,children:[(0,a.jsx)("h2",{children:"\uD83D\uDCE6 Inventaire"}),(0,a.jsx)("button",{className:l().btnPrimary,onClick:()=>o(!i),children:i?"✕ Annuler":"+ Ajouter un item"})]}),i&&(0,a.jsxs)("form",{className:l().form,onSubmit:p,children:[(0,a.jsx)("input",{type:"text",placeholder:"Nom de l'item",value:c.item_name,onChange:e=>d({...c,item_name:e.target.value}),required:!0}),(0,a.jsx)("select",{value:c.category,onChange:e=>d({...c,category:e.target.value}),children:["Vaisselle","\xc9lectrom\xe9nager","Mobilier","\xc9quipements","Autre"].map(e=>(0,a.jsx)("option",{value:e,children:e},e))}),(0,a.jsx)("input",{type:"number",min:"1",placeholder:"Quantit\xe9",value:c.quantity,onChange:e=>d({...c,quantity:parseInt(e.target.value)})}),(0,a.jsx)("select",{value:c.condition,onChange:e=>d({...c,condition:e.target.value}),children:["ok","\xe0 remplacer","HS"].map(e=>(0,a.jsx)("option",{value:e,children:e},e))}),(0,a.jsx)("textarea",{placeholder:"Commentaires (optionnel)",value:c.notes,onChange:e=>d({...c,notes:e.target.value}),rows:"2"}),(0,a.jsx)("button",{type:"submit",className:l().btnSuccess,children:"Ajouter"})]}),(0,a.jsx)("div",{className:l().inventory,children:Object.entries(u).map(e=>{let[t,n]=e;return(0,a.jsxs)("div",{className:l().categorySection,children:[(0,a.jsx)("h3",{children:t}),(0,a.jsx)("div",{className:l().itemsGrid,children:n.map(e=>(0,a.jsxs)("div",{className:l().inventoryCard,children:[(0,a.jsxs)("div",{className:l().cardHeader,children:[(0,a.jsx)("strong",{children:e.item_name}),(0,a.jsx)("span",{className:l().conditionBadge,style:{backgroundColor:h(e.condition)},children:e.condition})]}),(0,a.jsxs)("p",{children:["Quantit\xe9 : ",(0,a.jsx)("strong",{children:e.quantity})]}),e.notes&&(0,a.jsx)("p",{className:l().notes,children:e.notes}),e.last_checked_at&&(0,a.jsxs)("p",{className:l().small,children:["V\xe9rifi\xe9 : ",new Date(e.last_checked_at).toLocaleDateString("fr-FR")]})]},e.id))})]},t)})}),0===t.length&&(0,a.jsx)("p",{className:l().empty,children:"Aucun item d'inventaire. Commencez par en ajouter."})]})}function u(e){let{sessions:t,propertyId:n,supabase:r}=e,[i,o]=(0,s.useState)(!1),[c,d]=(0,s.useState)({scheduled_date:"",cleaning_type:"standard",duration_hours:3,notes:""}),u=async e=>{e.preventDefault();try{let{error:e}=await r.from("cleaning_sessions").insert([{property_id:n,...c,is_completed:!1}]);if(e)throw e;d({scheduled_date:"",cleaning_type:"standard",duration_hours:3,notes:""}),o(!1),window.location.reload()}catch(e){alert("Erreur : "+e.message)}},p=async(e,t)=>{try{let{error:n}=await r.from("cleaning_sessions").update({is_completed:!t,completed_at:t?null:new Date().toISOString()}).eq("id",e);if(n)throw n;window.location.reload()}catch(e){alert("Erreur : "+e.message)}},h=t.filter(e=>!e.is_completed),m=t.filter(e=>e.is_completed);return(0,a.jsxs)("div",{className:l().tabPanel,children:[(0,a.jsxs)("div",{className:l().header,children:[(0,a.jsx)("h2",{children:"\uD83E\uDDF9 M\xe9nage"}),(0,a.jsx)("button",{className:l().btnPrimary,onClick:()=>o(!i),children:i?"✕ Annuler":"+ Planifier un m\xe9nage"})]}),i&&(0,a.jsxs)("form",{className:l().form,onSubmit:u,children:[(0,a.jsx)("input",{type:"date",value:c.scheduled_date,onChange:e=>d({...c,scheduled_date:e.target.value}),required:!0}),(0,a.jsxs)("select",{value:c.cleaning_type,onChange:e=>d({...c,cleaning_type:e.target.value}),children:[(0,a.jsx)("option",{value:"standard",children:"Standard"}),(0,a.jsx)("option",{value:"approfondi",children:"Approfondi"})]}),(0,a.jsx)("input",{type:"number",min:"0.5",step:"0.5",placeholder:"Dur\xe9e (heures)",value:c.duration_hours,onChange:e=>d({...c,duration_hours:parseFloat(e.target.value)})}),(0,a.jsx)("textarea",{placeholder:"Commentaires (optionnel)",value:c.notes,onChange:e=>d({...c,notes:e.target.value}),rows:"2"}),(0,a.jsx)("button",{type:"submit",className:l().btnSuccess,children:"Planifier"})]}),h.length>0&&(0,a.jsxs)("section",{className:l().section,children:[(0,a.jsx)("h3",{children:"\uD83D\uDCCB \xc0 faire"}),(0,a.jsx)("div",{className:l().list,children:h.map(e=>(0,a.jsxs)("div",{className:l().listItem,children:[(0,a.jsxs)("div",{className:l().itemHeader,children:[(0,a.jsxs)("strong",{children:[new Date(e.scheduled_date).toLocaleDateString("fr-FR")," - ","approfondi"===e.cleaning_type?"M\xe9nage approfondi":"M\xe9nage standard"]}),(0,a.jsx)("button",{className:l().btnSmall,onClick:()=>p(e.id,e.is_completed),children:"✓ Marquer comme compl\xe9t\xe9"})]}),(0,a.jsxs)("p",{children:["Dur\xe9e : ",e.duration_hours,"h ",e.notes&&"| ".concat(e.notes)]})]},e.id))})]}),m.length>0&&(0,a.jsxs)("section",{className:l().section,children:[(0,a.jsx)("h3",{children:"✅ Compl\xe9t\xe9"}),(0,a.jsx)("div",{className:l().list,children:m.map(e=>(0,a.jsxs)("div",{className:"".concat(l().listItem," ").concat(l().completed),children:[(0,a.jsxs)("div",{className:l().itemHeader,children:[(0,a.jsx)("strong",{children:new Date(e.scheduled_date).toLocaleDateString("fr-FR")}),(0,a.jsx)("span",{className:l().badge,children:"Compl\xe9t\xe9"})]}),(0,a.jsxs)("p",{children:["Dur\xe9e : ",e.duration_hours,"h"]})]},e.id))})]}),0===t.length&&(0,a.jsx)("p",{className:l().empty,children:"Aucune session de m\xe9nage planifi\xe9e."})]})}function p(e){let{linensData:t,propertyId:n,supabase:r}=e,[i,o]=(0,s.useState)(!1),[c,d]=(0,s.useState)({linen_type:"Draps",quantity:1,status:"Disponible"}),u=["Disponible","Propre","Sale","En lavage","Manquant"],p=async e=>{e.preventDefault();try{let{error:e}=await r.from("linens").insert([{property_id:n,...c}]);if(e)throw e;d({linen_type:"Draps",quantity:1,status:"Disponible"}),o(!1),window.location.reload()}catch(e){alert("Erreur : "+e.message)}},h=async(e,t)=>{try{let{error:n}=await r.from("linens").update({status:t,last_status_change_at:new Date().toISOString()}).eq("id",e);if(n)throw n;window.location.reload()}catch(e){alert("Erreur : "+e.message)}},m=e=>{switch(e){case"Disponible":return"#4CAF50";case"Propre":return"#2196F3";case"Sale":return"#FF5722";case"En lavage":return"#FF9800";case"Manquant":return"#9C27B0";default:return"#757575"}};return(0,a.jsxs)("div",{className:l().tabPanel,children:[(0,a.jsxs)("div",{className:l().header,children:[(0,a.jsx)("h2",{children:"\uD83D\uDC55 Gestion du Linge"}),(0,a.jsx)("button",{className:l().btnPrimary,onClick:()=>o(!i),children:i?"✕ Annuler":"+ Ajouter du linge"})]}),i&&(0,a.jsxs)("form",{className:l().form,onSubmit:p,children:[(0,a.jsx)("select",{value:c.linen_type,onChange:e=>d({...c,linen_type:e.target.value}),children:["Draps","Serviettes","Housses de couette","Taies d&apos;oreiller","Autre"].map(e=>(0,a.jsx)("option",{value:e,children:e},e))}),(0,a.jsx)("input",{type:"number",min:"1",placeholder:"Quantit\xe9",value:c.quantity,onChange:e=>d({...c,quantity:parseInt(e.target.value)})}),(0,a.jsx)("select",{value:c.status,onChange:e=>d({...c,status:e.target.value}),children:u.map(e=>(0,a.jsx)("option",{value:e,children:e},e))}),(0,a.jsx)("button",{type:"submit",className:l().btnSuccess,children:"Ajouter"})]}),(0,a.jsx)("div",{className:l().linensGrid,children:t.map(e=>(0,a.jsxs)("div",{className:l().linensCard,children:[(0,a.jsxs)("div",{className:l().cardHeader,children:[(0,a.jsx)("strong",{children:e.linen_type}),(0,a.jsxs)("span",{className:l().quantity,children:["x",e.quantity]})]}),(0,a.jsxs)("div",{className:l().statusSelector,children:[(0,a.jsx)("select",{value:e.status,onChange:t=>h(e.id,t.target.value),children:u.map(e=>(0,a.jsx)("option",{value:e,children:e},e))}),(0,a.jsx)("span",{className:l().statusBadge,style:{backgroundColor:m(e.status)},children:e.status})]})]},e.id))}),0===t.length&&(0,a.jsx)("p",{className:l().empty,children:"Aucun linge enregistr\xe9. Commencez par en ajouter."})]})}},8675:function(e,t,n){"use strict";n.d(t,{e:function(){return r}});var a=n(3053);let s=null,r=()=>s||(s=(0,a.eI)("https://kcvgxxqvhfcgifymgpji.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtjdmd4eHF2aGZjZ2lmeW1ncGppIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzMDAxMzAsImV4cCI6MjA4Mzg3NjEzMH0.3D1oyy3CzLDn6ElP351fdyuHzG5tdn9ISO1oRu1o8JE"));r()},9816:function(e){e.exports={container:"operations_container___2y7q",propertySelector:"operations_propertySelector__jde_n",tabNav:"operations_tabNav__4zKpt",tab:"operations_tab___lqYH",active:"operations_active__pKGOW",tabContent:"operations_tabContent__1ns0O",tabPanel:"operations_tabPanel__D2yQf",fadeIn:"operations_fadeIn__Nzxuu",header:"operations_header__YoBr3",btnPrimary:"operations_btnPrimary__WU9gp",btnSuccess:"operations_btnSuccess__uDcJT",btnSmall:"operations_btnSmall__9D9S8",form:"operations_form__tTiV8",list:"operations_list__I9nH5",listItem:"operations_listItem__GcwE9",completed:"operations_completed__vfuhA",itemHeader:"operations_itemHeader__bxgoZ",badge:"operations_badge__BZ_A1",conditionBadge:"operations_conditionBadge__bdAra",statusBadge:"operations_statusBadge__lNoub",inventory:"operations_inventory__xerGY",categorySection:"operations_categorySection__usJiJ",itemsGrid:"operations_itemsGrid__e1RYt",inventoryCard:"operations_inventoryCard__dUKvK",cardHeader:"operations_cardHeader__zJ4nG",notes:"operations_notes__ecOCu",small:"operations_small__CS7Ml",linensGrid:"operations_linensGrid__DZqJy",linensCard:"operations_linensCard__1Wxg8",quantity:"operations_quantity__S_UIk",statusSelector:"operations_statusSelector__WH24e",section:"operations_section__MT1YL",empty:"operations_empty__bOybB",loading:"operations_loading__s0Xfd",error:"operations_error__j7YZC"}}},function(e){e.O(0,[508,53,971,117,744],function(){return e(e.s=9911)}),_N_E=e.O()}]);