(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[948],{1788:function(e,r,s){Promise.resolve().then(s.bind(s,2333))},2333:function(e,r,s){"use strict";s.r(r);var t=s(7437),n=s(2265),i=s(7648),a=s(9376),l=s(9120),u=s(2563),o=s(8675);r.default=(0,u.c)(function(){let e=(0,a.useRouter)(),[r,s]=(0,n.useState)(null),[u,c]=(0,n.useState)({slug:"",title:"",description:"",location:"",price_per_night:"",max_guests:1,bedrooms:1,bathrooms:1,is_published:!1}),[m,d]=(0,n.useState)(!1),[h,p]=(0,n.useState)(""),[g,x]=(0,n.useState)("");(0,n.useEffect)(()=>{(async()=>{let e=(0,o.e)(),{data:{user:r}}=await e.auth.getUser();if(!r)return;let{data:t}=await e.from("org_members").select("org_id").eq("user_id",r.id).single();t&&s(t.org_id)})()},[]);let f=e=>{let{name:r,value:s,type:t,checked:n}=e.target;c(e=>({...e,[r]:"checkbox"===t?n:"number"===t?parseInt(s):s}))},j=async s=>{s.preventDefault(),p(""),x(""),d(!0);try{if(!r)throw Error("Org ID not found");let s=(0,o.e)(),{data:t,error:n}=await s.from("properties").insert([{...u,org_id:r,price_per_night:parseFloat(u.price_per_night)}]).select();if(n)throw n;x("Logement cr\xe9\xe9 avec succ\xe8s"),setTimeout(()=>{e.push("/admin/logements")},1500)}catch(e){p(e.message||"Erreur lors de la cr\xe9ation")}finally{d(!1)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Pm,{}),(0,t.jsx)("div",{className:"page-container",children:(0,t.jsxs)("div",{className:"container",style:{maxWidth:"800px"},children:[(0,t.jsx)(i.default,{href:"/admin/logements",style:{color:"#4F46E5"},children:"← Retour"}),(0,t.jsx)("h1",{style:{marginTop:"1rem"},children:"Cr\xe9er un logement"}),h&&(0,t.jsx)("div",{className:"error-message",style:{marginTop:"1rem"},children:h}),g&&(0,t.jsx)("div",{className:"success-message",style:{marginTop:"1rem"},children:g}),(0,t.jsxs)("form",{onSubmit:j,style:{marginTop:"2rem"},children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Slug (URL)"}),(0,t.jsx)("input",{type:"text",name:"slug",value:u.slug,onChange:f,required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Titre"}),(0,t.jsx)("input",{type:"text",name:"title",value:u.title,onChange:f,required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Description"}),(0,t.jsx)("textarea",{name:"description",value:u.description,onChange:f})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Localisation"}),(0,t.jsx)("input",{type:"text",name:"location",value:u.location,onChange:f,required:!0})]}),(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Prix par nuit (€)"}),(0,t.jsx)("input",{type:"number",name:"price_per_night",value:u.price_per_night,onChange:f,step:"0.01",required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Personnes maximum"}),(0,t.jsx)("input",{type:"number",name:"max_guests",value:u.max_guests,onChange:f,min:"1",required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Chambres"}),(0,t.jsx)("input",{type:"number",name:"bedrooms",value:u.bedrooms,onChange:f,min:"1",required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"Salles de bain"}),(0,t.jsx)("input",{type:"number",name:"bathrooms",value:u.bathrooms,onChange:f,min:"1",required:!0})]})]}),(0,t.jsx)("div",{className:"form-group",children:(0,t.jsxs)("label",{style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[(0,t.jsx)("input",{type:"checkbox",name:"is_published",checked:u.is_published,onChange:f,style:{marginRight:"0.5rem",width:"auto"}}),"Publier ce logement"]})}),(0,t.jsx)("button",{type:"submit",disabled:m,className:"btn-primary",children:m?"Cr\xe9ation...":"Cr\xe9er le logement"})]})]})})]})})},2563:function(e,r,s){"use strict";s.d(r,{Q:function(){return l},c:function(){return u}});var t=s(7437),n=s(2265),i=s(9376),a=s(8675);function l(e){return function(r){let s=(0,i.useRouter)(),[l,u]=(0,n.useState)(!0),[o,c]=(0,n.useState)(null);return((0,n.useEffect)(()=>{(async()=>{let e=(0,a.e)(),{data:{user:r}}=await e.auth.getUser();if(!r){s.push("/login");return}c(r),u(!1)})()},[s]),l)?(0,t.jsx)("div",{children:"Chargement..."}):(0,t.jsx)(e,{...r,user:o})}}function u(e){return function(r){let s=(0,i.useRouter)(),[l,u]=(0,n.useState)(!0),[o,c]=(0,n.useState)(null),[m,d]=(0,n.useState)(null);return((0,n.useEffect)(()=>{(async()=>{let e=(0,a.e)(),{data:{user:r}}=await e.auth.getUser();if(!r){s.push("/admin/login");return}let{data:t}=await e.from("org_members").select("role").eq("user_id",r.id).single();if(!t||"admin"!==t.role){s.push("/");return}c(r),d(t.role),u(!1)})()},[s]),l)?(0,t.jsx)("div",{children:"Chargement..."}):(0,t.jsx)(e,{...r,user:o,role:m})}}},9376:function(e,r,s){"use strict";var t=s(5475);s.o(t,"useRouter")&&s.d(r,{useRouter:function(){return t.useRouter}})}},function(e){e.O(0,[223,120,971,117,744],function(){return e(e.s=1788)}),_N_E=e.O()}]);